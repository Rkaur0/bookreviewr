<%- include('layout', { user: user }) %>

<div class="container mt-4">
  <a href="/book/<%= book.id %>" class="btn btn-secondary mb-3">&larr; Back</a>

  <h2><%= review ? 'Edit Review' : 'Write a Review' %> for <%= book.title %></h2>

  <form method="POST" action="<%= review ? '/api/reviews/' + review.id + '?_method=PUT' : '/api/reviews' %>">
    <input type="hidden" name="book_id" value="<%= book.id %>">

    <div class="mb-3">
      <label for="rating" class="form-label">Rating (1-5)</label>
      <input type="number" id="rating" name="rating" class="form-control" min="1" max="5" 
             value="<%= review ? review.rating : '' %>" required>
    </div>

    <div class="mb-3">
      <label for="title" class="form-label">Review Title</label>
      <input type="text" id="title" name="title" class="form-control"
             value="<%= review ? review.title : '' %>" required>
    </div>

    <div class="mb-3">
      <label for="body" class="form-label">Review Body</label>
      <textarea id="body" name="body" class="form-control" rows="5" required><%= review ? review.body : '' %></textarea>
    </div>

    <div class="mb-3 form-check">
      <input type="checkbox" class="form-check-input" id="contains_spoilers" name="contains_spoilers" 
             <%= review && review.contains_spoilers ? 'checked' : '' %>>
      <label class="form-check-label" for="contains_spoilers">Contains Spoilers</label>
    </div>

    <button type="submit" class="btn btn-primary">Save Review</button>
  </form>
</div>
